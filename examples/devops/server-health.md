# 🖥️ Server Health Dashboard

<!-- xmd:set report_time=now -->
<!-- xmd:set servers=["web1.example.com", "web2.example.com", "db1.example.com"] -->
<!-- xmd:set services=["nginx", "postgresql", "redis"] -->

**Generated:** <!-- xmd:exec date "+%Y-%m-%d %H:%M:%S %Z" -->  
**Report ID:** <!-- xmd:exec uuidgen | cut -d- -f1 -->

---

## 📊 System Overview

### Load Average
```
<!-- xmd:exec uptime | sed 's/.*load average: //' -->
```

### Memory Usage
- **Total:** <!-- xmd:exec free -h | awk 'NR==2{print $2}' -->
- **Used:** <!-- xmd:exec free -h | awk 'NR==2{print $3}' -->
- **Available:** <!-- xmd:exec free -h | awk 'NR==2{print $7}' -->
- **Usage:** <!-- xmd:exec free | awk 'NR==2{printf "%.1f%%", $3*100/$2}' -->

### Disk Usage
```
<!-- xmd:exec df -h | grep -E '^/dev/' | awk '{print $6 ": " $5 " (" $3 "/" $2 ")"}' -->
```

---

## 🌐 Server Status

<!-- xmd:for server in servers -->
### {{server}}

**Connectivity:** <!-- xmd:exec ping -c1 -W2 {{server}} >/dev/null 2>&1 && echo "🟢 Online" || echo "🔴 Offline" -->

<!-- xmd:if ping -c1 -W2 {{server}} >/dev/null 2>&1 -->
**Details:**
- **Response Time:** <!-- xmd:exec ping -c1 {{server}} 2>/dev/null | grep 'time=' | sed 's/.*time=//' | sed 's/ ms/ms/' -->
- **SSH Access:** <!-- xmd:exec nc -z -w2 {{server}} 22 2>/dev/null && echo "✅ Available" || echo "❌ Unavailable" -->
- **HTTP Status:** <!-- xmd:exec curl -s -o /dev/null -w "%{http_code}" http://{{server}} --connect-timeout 5 || echo "Failed" -->

<!-- xmd:else -->
**Status:** Server is not responding to ping requests.
<!-- xmd:endif -->

---
<!-- xmd:endfor -->

## 🔧 Service Status

<!-- xmd:for service in services -->
### {{service}}

**Status:** <!-- xmd:exec systemctl is-active {{service}} 2>/dev/null || echo "inactive" -->
**Enabled:** <!-- xmd:exec systemctl is-enabled {{service}} 2>/dev/null || echo "disabled" -->

<!-- xmd:if systemctl is-active {{service}} >/dev/null 2>&1 -->
**Process Info:**
```
<!-- xmd:exec ps aux | grep {{service}} | grep -v grep | head -3 || echo "No processes found" -->
```

**Memory Usage:**
<!-- xmd:exec ps -o pid,ppid,%mem,%cpu,cmd -C {{service}} --no-headers 2>/dev/null | head -5 || echo "Process not found" -->

<!-- xmd:else -->
**Note:** Service is not currently running.
<!-- xmd:endif -->

---
<!-- xmd:endfor -->

## 📈 Performance Metrics

### CPU Usage (Last 5 Minutes)
```
<!-- xmd:exec top -bn1 | grep "Cpu(s)" | awk '{print "User: " $2 ", System: " $4 ", Idle: " $8}' -->
```

### Top Processes by Memory
```
<!-- xmd:exec ps aux --sort=-%mem | head -6 | awk '{printf "%-10s %6s %6s %s\n", $1, $3, $4, $11}' -->
```

### Top Processes by CPU
```
<!-- xmd:exec ps aux --sort=-%cpu | head -6 | awk '{printf "%-10s %6s %6s %s\n", $1, $3, $4, $11}' -->
```

### Network Connections
**Active connections:** <!-- xmd:exec netstat -tun | wc -l -->
**Listening ports:** <!-- xmd:exec netstat -tln | grep LISTEN | wc -l -->

---

## 🚨 Alerts & Warnings

<!-- xmd:set high_load_threshold=2.0 -->
<!-- xmd:set high_memory_threshold=80 -->
<!-- xmd:set high_disk_threshold=85 -->

### Load Average Check
<!-- xmd:set current_load=$(uptime | awk '{print $(NF-2)}' | sed 's/,//') -->

<!-- xmd:if current_load > high_load_threshold -->
🚨 **HIGH LOAD ALERT**: Current load average ({{current_load}}) exceeds threshold ({{high_load_threshold}})
<!-- xmd:else -->
✅ Load average is within normal range
<!-- xmd:endif -->

### Memory Usage Check
<!-- xmd:set memory_usage=$(free | awk 'NR==2{printf "%.0f", $3*100/$2}') -->

<!-- xmd:if memory_usage > high_memory_threshold -->
🚨 **HIGH MEMORY USAGE**: {{memory_usage}}% exceeds threshold ({{high_memory_threshold}}%)
<!-- xmd:else -->
✅ Memory usage is within normal range ({{memory_usage}}%)
<!-- xmd:endif -->

### Disk Usage Check
<!-- xmd:set root_disk_usage=$(df / | awk 'NR==2{print $5}' | sed 's/%//') -->

<!-- xmd:if root_disk_usage > high_disk_threshold -->
🚨 **HIGH DISK USAGE**: Root filesystem at {{root_disk_usage}}% exceeds threshold ({{high_disk_threshold}}%)
<!-- xmd:else -->
✅ Disk usage is within normal range ({{root_disk_usage}}%)
<!-- xmd:endif -->

---

## 📝 Recent Logs

### System Errors (Last 10)
```
<!-- xmd:exec journalctl -p err -n 10 --no-pager 2>/dev/null | tail -10 || echo "No recent errors" -->
```

### Authentication Logs (Last 5)
```
<!-- xmd:exec journalctl _COMM=sshd -n 5 --no-pager 2>/dev/null | tail -5 || echo "No recent auth logs" -->
```

---

## 🔄 Automatic Actions

<!-- xmd:if memory_usage > 90 -->
**Auto-restart high memory services:**

<!-- xmd:for service in ["apache2", "mysql"] -->
- Restarting {{service}}: <!-- xmd:exec sudo systemctl restart {{service}} && echo "✅ Success" || echo "❌ Failed" -->
<!-- xmd:endfor -->
<!-- xmd:endif -->

---

<small>
**Report generated by XMD** • 
**Last updated:** <!-- xmd:exec date "+%Y-%m-%d %H:%M:%S" --> • 
**Hostname:** <!-- xmd:exec hostname --> • 
**Kernel:** <!-- xmd:exec uname -r -->
</small>